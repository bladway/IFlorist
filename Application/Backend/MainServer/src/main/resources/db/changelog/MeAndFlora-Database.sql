DROP TABLE IF EXISTS PROC_REQUEST;

DROP TABLE IF EXISTS U_SESSION;

DROP TABLE IF EXISTS MAF_USER;

DROP TABLE IF EXISTS FLORA;

CREATE EXTENSION IF NOT EXISTS postgis;

CREATE EXTENSION IF NOT EXISTS postgis_topology;

CREATE TABLE IF NOT EXISTS MAF_USER (
    USER_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
    LOGIN VARCHAR(25) NOT NULL UNIQUE,
    PASSWORD VARCHAR(25) NOT NULL,
    ROLE VARCHAR(25) NOT NULL
);

CREATE TABLE IF NOT EXISTS U_SESSION (
    SESSION_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
    IP_ADDRESS VARCHAR(16) NOT NULL,
    CREATED_TIME TIMESTAMP WITH TIME ZONE NOT NULL,
    JWT VARCHAR(255) NOT NULL UNIQUE,
    JWT_R VARCHAR(255) NOT NULL UNIQUE,
    USER_ID BIGINT REFERENCES MAF_USER(USER_ID)
);

CREATE TABLE IF NOT EXISTS FLORA (
    FLORA_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL  PRIMARY KEY,
    IMAGE_PATH VARCHAR(30) NOT NULL,
    NAME VARCHAR(50) NOT NULL UNIQUE,
    DESCRIPTION TEXT NOT NULL,
    TYPE VARCHAR(20) NOT NULL
);

CREATE TABLE IF NOT EXISTS PROC_REQUEST (
    REQUEST_ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL PRIMARY KEY,
    IMAGE_PATH VARCHAR(30) NOT NULL,
    CREATED_TIME TIMESTAMP WITH TIME ZONE NOT NULL,
    POSTED_TIME TIMESTAMP WITH TIME ZONE,
    GEO_POS GEOMETRY,
    STATUS VARCHAR(25) NOT NULL,
    SESSION_ID BIGINT REFERENCES U_SESSION(SESSION_ID) NOT NULL,
    FLORA_ID BIGINT REFERENCES FLORA(FLORA_ID)
);

INSERT INTO FLORA (IMAGE_PATH, NAME, DESCRIPTION, TYPE) VALUES ('get/Одуванчик.jpg', 'Одуванчик', 'my best friend', 'plant');
